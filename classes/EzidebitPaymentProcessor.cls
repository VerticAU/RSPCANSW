//Generated by wsdl2apex
//https://api.ezidebit.com.au/v3-5/pci?wsdl
//https://api.ezidebit.com.au/v3-5/nonpci?wsdl

public class EzidebitPaymentProcessor {
    private final static String LIVE_ENDPOINT_URL = 'https://api.ezidebit.com.au/v3-5'; // "/nonpci" OR "/pci"
    private final static String TEST_ENDPOINT_URL = 'https://api.demo.ezidebit.com.au/v3-5'; // "/nonpci" OR "/pci"

    private final static Integer SUCCESS_RESULT = 0;

    private final NonPCIService nonPCIService;
    private final String digitalKey;

    public EzidebitPaymentProcessor(Payment_Gateway_Credentials__c paymentGatewayCredentials) {
        this(paymentGatewayCredentials.API_Key__c, paymentGatewayCredentials.Is_Test__c);
    }

    public EzidebitPaymentProcessor(String digitalKey, Boolean isTest) {
        this.nonPCIService = new NonPCIService(isTest);
        this.digitalKey = digitalKey;
    }

    public EzidebitStructs.BPayCRN getCRN(String payerNumber, String username) {
        EzidebitPaymentProcessor.EziResponseOfDataTHgMB7oL response = this.nonPCIService.GetBPayCRN(
            this.digitalKey,
            payerNumber,
            username
        );
        if (SUCCESS_RESULT != response.Error){
            throw new vertic_Structs.InvalidDataException(response.ErrorMessage);
        }
        if (response.Data == null) {
            throw new vertic_Structs.InvalidDataException('Data is empty!');
        }

        System.debug('response ' + response);
        System.debug('response.Data ' + response.Data);

        EzidebitStructs.BPayCRN bPayCRN = new EzidebitStructs.BPayCRN();
        bPayCRN.BPayCRN = response.Data.BPayCRN;
        bPayCRN.BPayBillerCode = response.Data.BPayBillerCode;

        return bPayCRN;
    }

    public List<EzidebitStructs.Payment> getPayments(String paymentType, String paymentMethod, String paymentSource, String paymentReference, String dateFrom, String dateTo, String dateField, String eziDebitCustomerID, String yourSystemReference) {
        EzidebitPaymentProcessor.EziResponseOfArrayOfPaymentTHgMB7oL response = this.nonPCIService.GetPayments(
            this.digitalKey,
            paymentType,
            paymentMethod,
            paymentSource,
            paymentReference,
            dateFrom,
            dateTo,
            dateField,
            eziDebitCustomerID,
            yourSystemReference
        );
        if (SUCCESS_RESULT != response.Error){
            throw new vertic_Structs.InvalidDataException(response.ErrorMessage);
        }
        if (response.Data == null || response.Data.Payment == null) {
            return new List<EzidebitStructs.Payment>();
        }

        System.debug('response ' + response);
        System.debug('response.Data ' + response.Data);

        List<EzidebitStructs.Payment> payments = new List<EzidebitStructs.Payment>();

        EzidebitStructs.Payment payment;
        for(EzidebitPaymentProcessor.Payment paymentData: response.Data.Payment) {
            payment = new EzidebitStructs.Payment();
            payment.BankFailedReason = paymentData.BankFailedReason;
            payment.BankReceiptID = paymentData.BankReceiptID;
            payment.BankReturnCode = paymentData.BankReturnCode;
            payment.CustomerName = paymentData.CustomerName;
            payment.DebitDate = paymentData.DebitDate;
            payment.EzidebitCustomerID = paymentData.EzidebitCustomerID;
            payment.InvoiceID = paymentData.InvoiceID;
            payment.PaymentAmount = paymentData.PaymentAmount;
            payment.PaymentID = paymentData.PaymentID;
            payment.PaymentMethod = paymentData.PaymentMethod;
            payment.PaymentReference = paymentData.PaymentReference;
            payment.PaymentSource = paymentData.PaymentSource;
            payment.PaymentStatus = paymentData.PaymentStatus;
            payment.ScheduledAmount = paymentData.ScheduledAmount;
            payment.SettlementDate = paymentData.SettlementDate;
            payment.TransactionFeeClient = paymentData.TransactionFeeClient;
            payment.TransactionFeeCustomer = paymentData.TransactionFeeCustomer;
            payment.TransactionTime = paymentData.TransactionTime;
            payment.YourGeneralReference = paymentData.YourGeneralReference;
            payment.YourSystemReference = paymentData.YourSystemReference;
            payments.add(payment);
        }

        System.debug(payments);

        return payments;
    }

    /**
     * NonPCI Service
     */
    private class NonPCIService {
        private String endpoint_x;
        private Map<String,String> inputHttpHeaders_x;
        private Map<String,String> outputHttpHeaders_x;
        private String clientCertName_x;
        private String clientCert_x;
        private String clientCertPasswd_x;
        private Integer timeout_x;
        private String[] ns_map_type_info = new String[]{'https://px.ezidebit.com.au/', 'EzidebitPaymentProcessor'};

        private NonPCIService(Boolean isTest) {
            this.endpoint_x = (isTest ? TEST_ENDPOINT_URL : LIVE_ENDPOINT_URL) + '/nonpci';
            this.timeout_x = 120000;
        }

        private EzidebitPaymentProcessor.EziResponseOfDataTHgMB7oL GetBPayCRN(String DigitalKey,String YourPayerNumber,String Username) {
            EzidebitPaymentProcessor.GetBPayCRN_element request_x = new EzidebitPaymentProcessor.GetBPayCRN_element();
            request_x.DigitalKey = DigitalKey;
            request_x.YourPayerNumber = YourPayerNumber;
            request_x.Username = Username;
            EzidebitPaymentProcessor.GetBPayCRNResponse_element response_x;
            Map<String, EzidebitPaymentProcessor.GetBPayCRNResponse_element> response_map_x = new Map<String, EzidebitPaymentProcessor.GetBPayCRNResponse_element>();
            response_map_x.put('response_x', response_x);
            WebServiceCallout.invoke(
                this,
                request_x,
                response_map_x,
                new String[]{endpoint_x,
                    'https://px.ezidebit.com.au/INonPCIService/GetBPayCRN',
                    'https://px.ezidebit.com.au/',
                    'GetBPayCRN',
                    'https://px.ezidebit.com.au/',
                    'GetBPayCRNResponse',
                    'EzidebitPaymentProcessor.GetBPayCRNResponse_element'}
            );
            response_x = response_map_x.get('response_x');
            return response_x.GetBPayCRNResult;
        }

        private EzidebitPaymentProcessor.EziResponseOfArrayOfPaymentTHgMB7oL GetPayments(String DigitalKey,String PaymentType,String PaymentMethod,String PaymentSource,String PaymentReference,String DateFrom,String DateTo,String DateField,String EziDebitCustomerID,String YourSystemReference) {
            EzidebitPaymentProcessor.GetPayments_element request_x = new EzidebitPaymentProcessor.GetPayments_element();
            request_x.DigitalKey = DigitalKey;
            request_x.PaymentType = PaymentType;
            request_x.PaymentMethod = PaymentMethod;
            request_x.PaymentSource = PaymentSource;
            request_x.PaymentReference = PaymentReference;
            request_x.DateFrom = DateFrom;
            request_x.DateTo = DateTo;
            request_x.DateField = DateField;
            request_x.EziDebitCustomerID = EziDebitCustomerID;
            request_x.YourSystemReference = YourSystemReference;

            System.debug(JSON.serialize(request_x));

            EzidebitPaymentProcessor.GetPaymentsResponse_element response_x;
            Map<String, EzidebitPaymentProcessor.GetPaymentsResponse_element> response_map_x = new Map<String, EzidebitPaymentProcessor.GetPaymentsResponse_element>();
            response_map_x.put('response_x', response_x);
            WebServiceCallout.invoke(
                this,
                request_x,
                response_map_x,
                new String[]{endpoint_x,
                    'https://px.ezidebit.com.au/INonPCIService/GetPayments',
                    'https://px.ezidebit.com.au/',
                    'GetPayments',
                    'https://px.ezidebit.com.au/',
                    'GetPaymentsResponse',
                    'EzidebitPaymentProcessor.GetPaymentsResponse_element'}
            );
            response_x = response_map_x.get('response_x');

            System.debug(JSON.serialize(response_x));

            return response_x.GetPaymentsResult;
        }
    }

    @TestVisible
    private class EziResponseOfArrayOfPaymentTHgMB7oL {
        public EzidebitPaymentProcessor.ArrayOfPayment Data;
        public Integer Error;
        public String ErrorMessage;
        private String[] Data_type_info = new String[]{'Data','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] Error_type_info = new String[]{'Error','https://px.ezidebit.com.au/',null,'0','1','false'};
        private String[] ErrorMessage_type_info = new String[]{'ErrorMessage','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'Data','Error','ErrorMessage'};
    }

    @TestVisible
    private class GetPaymentsResponse_element {
        public EzidebitPaymentProcessor.EziResponseOfArrayOfPaymentTHgMB7oL GetPaymentsResult;
        private String[] GetPaymentsResult_type_info = new String[]{'GetPaymentsResult','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'GetPaymentsResult'};
    }

    @TestVisible
    private class GetPayments_element {
        public String DigitalKey;
        public String PaymentType;
        public String PaymentMethod;
        public String PaymentSource;
        public String PaymentReference;
        public String DateFrom;
        public String DateTo;
        public String DateField;
        public String EziDebitCustomerID;
        public String YourSystemReference;
        private String[] DigitalKey_type_info = new String[]{'DigitalKey','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentType_type_info = new String[]{'PaymentType','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentMethod_type_info = new String[]{'PaymentMethod','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentSource_type_info = new String[]{'PaymentSource','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentReference_type_info = new String[]{'PaymentReference','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] DateFrom_type_info = new String[]{'DateFrom','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] DateTo_type_info = new String[]{'DateTo','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] DateField_type_info = new String[]{'DateField','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] EziDebitCustomerID_type_info = new String[]{'EziDebitCustomerID','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] YourSystemReference_type_info = new String[]{'YourSystemReference','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'DigitalKey','PaymentType','PaymentMethod','PaymentSource','PaymentReference','DateFrom','DateTo','DateField','EziDebitCustomerID','YourSystemReference'};
    }

    @TestVisible
    private class Payment {
        public String BankFailedReason;
        public String BankReceiptID;
        public String BankReturnCode;
        public String CustomerName;
        public DateTime DebitDate;
        public String EzidebitCustomerID;
        public String InvoiceID;
        public Double PaymentAmount;
        public String PaymentID;
        public String PaymentMethod;
        public String PaymentReference;
        public String PaymentSource;
        public String PaymentStatus;
        public Double ScheduledAmount;
        public DateTime SettlementDate;
        public Double TransactionFeeClient;
        public Double TransactionFeeCustomer;
        public DateTime TransactionTime;
        public String YourGeneralReference;
        public String YourSystemReference;
        private String[] BankFailedReason_type_info = new String[]{'BankFailedReason','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] BankReceiptID_type_info = new String[]{'BankReceiptID','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] BankReturnCode_type_info = new String[]{'BankReturnCode','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] CustomerName_type_info = new String[]{'CustomerName','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] DebitDate_type_info = new String[]{'DebitDate','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] EzidebitCustomerID_type_info = new String[]{'EzidebitCustomerID','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] InvoiceID_type_info = new String[]{'InvoiceID','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentAmount_type_info = new String[]{'PaymentAmount','https://px.ezidebit.com.au/',null,'0','1','false'};
        private String[] PaymentID_type_info = new String[]{'PaymentID','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentMethod_type_info = new String[]{'PaymentMethod','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentReference_type_info = new String[]{'PaymentReference','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentSource_type_info = new String[]{'PaymentSource','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] PaymentStatus_type_info = new String[]{'PaymentStatus','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] ScheduledAmount_type_info = new String[]{'ScheduledAmount','https://px.ezidebit.com.au/',null,'0','1','false'};
        private String[] SettlementDate_type_info = new String[]{'SettlementDate','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] TransactionFeeClient_type_info = new String[]{'TransactionFeeClient','https://px.ezidebit.com.au/',null,'0','1','false'};
        private String[] TransactionFeeCustomer_type_info = new String[]{'TransactionFeeCustomer','https://px.ezidebit.com.au/',null,'0','1','false'};
        private String[] TransactionTime_type_info = new String[]{'TransactionTime','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] YourGeneralReference_type_info = new String[]{'YourGeneralReference','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] YourSystemReference_type_info = new String[]{'YourSystemReference','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'BankFailedReason','BankReceiptID','BankReturnCode','CustomerName','DebitDate','EzidebitCustomerID','InvoiceID','PaymentAmount','PaymentID','PaymentMethod','PaymentReference','PaymentSource','PaymentStatus','ScheduledAmount','SettlementDate','TransactionFeeClient','TransactionFeeCustomer','TransactionTime','YourGeneralReference','YourSystemReference'};
    }

    @TestVisible
    private class ArrayOfPayment {
        public EzidebitPaymentProcessor.Payment[] Payment;
        private String[] Payment_type_info = new String[]{'Payment','https://px.ezidebit.com.au/',null,'0','-1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'Payment'};
    }

    @TestVisible
    public class GetBPayCRNResponse_element {
        public EzidebitPaymentProcessor.EziResponseOfDataTHgMB7oL GetBPayCRNResult;
        private String[] GetBPayCRNResult_type_info = new String[]{'GetBPayCRNResult','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'GetBPayCRNResult'};
    }

    @TestVisible
    private class EziResponseOfDataTHgMB7oL {
        public EzidebitPaymentProcessor.Data Data;
        public Integer Error;
        public String ErrorMessage;
        private String[] Data_type_info = new String[]{'Data','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] Error_type_info = new String[]{'Error','https://px.ezidebit.com.au/',null,'0','1','false'};
        private String[] ErrorMessage_type_info = new String[]{'ErrorMessage','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'Data','Error','ErrorMessage'};
    }

    @TestVisible
    private class Data {
        public String BPayBillerCode;
        public String BPayCRN;
        private String[] BPayBillerCode_type_info = new String[]{'BPayBillerCode','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] BPayCRN_type_info = new String[]{'BPayCRN','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'BPayBillerCode','BPayCRN'};
    }

    @TestVisible
    public class GetBPayCRN_element {
        public String DigitalKey;
        public String YourPayerNumber;
        public String Username;
        private String[] DigitalKey_type_info = new String[]{'DigitalKey','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] YourPayerNumber_type_info = new String[]{'YourPayerNumber','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] Username_type_info = new String[]{'Username','https://px.ezidebit.com.au/',null,'0','1','true'};
        private String[] apex_schema_type_info = new String[]{'https://px.ezidebit.com.au/','true','false'};
        private String[] field_order_type_info = new String[]{'DigitalKey','YourPayerNumber','Username'};
    }
}